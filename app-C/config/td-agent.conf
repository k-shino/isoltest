<source>
  type exec
  command vmstat | awk 'BEGIN{OFS="\t"} NR==3 {print $1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17}'
  keys vmstat_procs-r,vmstat_procs-w,vmstat_mem-swpd,vmstat_mem-free,vmstat_mem-buff,vmstat_mem-cache,vmstat_swap-in,vmstat_swap-out,vmstat_io-blockin,vmstat_io-blockout,vmstat_system-in,vmstat_system-cs,vmstat_cpu-usr,vmstat_cpu-sys,vmstat_cpu-idle,vmstat_cpu-wait,vmstat_cpu-steal
  format tsv
  tag devallo.vmstat
  run_interval 3s
</source>

<source>
  type exec
  command free -m | awk 'BEGIN{OFS="\t"} NR==2 {print $2,$4,$6,$7,(1-($4+$6+$7)/$2)*100}'
  keys free_mem-total,free_mem-free-free,free_mem-buffer,free_mem-cached,free_mem-used-per
  format tsv
  tag devallo.mem_use
  run_interval 3s
</source>

<source>
  type exec
  command df | awk 'BEGIN{OFS="\t"} NR==2 {print $2,$3,$3/$2*100}'
  keys df_disk-total,df_disk-used,df_disk-used-per
  format tsv
  tag devallo.disk_use
  run_interval 3s
</source>

<source>
  type exec
  command python /home/script_fluentd/netito_fluentd.py
  format json
  tag devallo.nic_use
  run_interval 3s
</source>

<source>
  type exec
  command python /home/script_fluentd/numastat_perf_fluentd.py
  format json
  tag devallo.top_numa_perf
  run_interval 3s
</source>

<source>
  type exec
  command python /home/script_fluentd/allocation_fluentd.py
  format json
  tag devallo.allocation
  run_interval 3s
</source>

<source>
  type exec
  command sar -W 1 1 | awk 'BEGIN{OFS="\t"} NR==4 {print $3,$4}'
  keys sar-W_pswpin/s,sar-W_pswpout/s
  format tsv
  tag devallo.sar-W
  run_interval 3s
</source>

<source>
  type exec
  command sar -w 1 1 | awk 'BEGIN{OFS="\t"} NR==4 {print $3,$4}'
  keys sar-w_proc/s,sar-w_cswch/s
  format tsv
  tag devallo.sar-w
  run_interval 3s
</source>

<source>
  type exec
  command sar -b 1 1 | awk 'BEGIN{OFS="\t"} NR==4 {print $3,$4,$5,$6,$7}'
  keys sar-b_tps/s,sar-b_rtps,sar-b_wtps,sar-b_bread/s,sar-b_bwrtn/s
  format tsv
  tag devallo.sar-b
  run_interval 3s
</source>

<source>
  type exec
  command sar -S 1 1 | awk 'BEGIN{OFS="\t"} NR==4 {print $3,$4,$5,$6,$7}'
  keys sar-S_kbswpfree,sar-S_kbswpused,sar-S_%swpused,sar-S_kbswcad,sar-S_%swpcad
  format tsv
  tag devallo.sar-S
  run_interval 3s
</source>

<source>
  type exec
  command python /home/script_fluentd/sar_fluentd.py
  format json
  tag devallo.sar-uPn
  run_interval 3s
</source>

<source>
  type exec
  command cat /home/overcommit.txt
  keys vcpe25-overcommit
  format tsv
  tag devallo.vcpe25-overcommit
  run_interval 3s
</source>

<source>
  type exec
  command python /home/script_fluentd/iperf_tail.py
  format json
  tag devallo.iperf
  run_interval 3s
</source>

<source>
  type exec
  command python /home/script_fluentd/virt-top_tail.py
  format json
  tag devallo.virt-top
  run_interval 3s
</source>

<source>
  type exec
  command python /home/script_fluentd/top_tail.py
  format json
  tag devallo.top
  run_interval 3s
</source>

<match devallo.*>
# ログ出力とSV00へ転送
  type copy
  <store>
    type forward
    retry_limit 1 
    flush_interval 1s
    num_threads 5
    <server>
      host 172.16.11.20
      port 24224
    </server>
  </store>
  <store>
    type file
    path /home/td-agent_log/fluentd
    # 最新ログファイルへのリンク
    symlink_path /home/td-agent_log/fluentd_current_buffer_link.log
    # ローテートするまでのログファイルサイズ
    buffer_chunk_limit 200m
  </store>
</match>
